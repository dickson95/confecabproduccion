<div class="row" id="form_lote_estado_update">
  <div class="col-lg-12">
    <div class="panel">
      <div class="panel-heading panel-default">
        <h4>Datos del proceso</h4>
      </div>
    </div>
  </div>
  <div class="col-lg-12">
    <%puts 'voy a armar el formulario'%>
    <%= simple_form_for(@lote, wrapper: :vertical_input_group,
            wrapper_mappings: {
              check_boxes: :horizontal_radio_and_checkboxes,
              radio_buttons: :horizontal_radio_and_checkboxes,
              file: :horizontal_file_input,
              boolean: :horizontal_boolean
            }) do |f| %>
            <%puts 'formulario inicializado'%>
        <%= f.fields_for :control_lotes, @lote.control_lotes.build do |c| %>
          <%= c.hidden_field :lote %>
          <div class="col-md-3">
            <%= c.input :fecha_ingreso, as: "string", 
            input_html: {:value => I18n::localize(Time.zone.utc_to_local(Time.new) + 60, :format => "%Y-%m-%d %H:%M:%S")},
            readonly: true, label: 'Entró a este proceso el día'  %>
          </div>
          <div class="col-md-3">
            <%= c.association :estado, :selected => params[:estado_id], 
            collection: Estado.all, label: 'Parte del proceso' %>
          </div>
          <%puts 'voy a  armar los subestados'%>
          
          <% # Sección del subestado %>
          <div class="col-md-3">
            <%= c.input :sub_estado, :label => 'Proceso adicional',  wrapper: :vertical_input_group do %>
              <%if params[:place] == "form_lote_sub_estado_response"%>
                <%= f.input_field  :sub_estado_id, class: "form-control",
                  :collection => @sub_estados, :value_method => :id, 
                  :selected => @sub_estado.id%>
                <div class="input-group-btn">
                  <%= link_to '...', add_remote_data_path(:place => "form_lote_sub_estado"),
                  {:remote => true, :class => "btn btn-default"} %>
                </div>
              <% else %>
                <%= c.input_field  :sub_estado_id, class: "form-control",
                :collection => @sub_estados, :value_method => :id%>
              
                <div class="input-group-btn">
                  <%= link_to '...', add_remote_data_path(:place => "form_lote_sub_estado"),
                  {:remote => true, :class => "btn btn-default"} %>
                </div>
              <% end %>
            <% end %>
            <%= f.hidden_field :_destroy %>
          </div>
        <% end %>
        <%puts 'formulario listo'%>
    <% end %>
  </div>
</div>