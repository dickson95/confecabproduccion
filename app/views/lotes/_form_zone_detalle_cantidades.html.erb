<table class="table table-bordered" id="table_form_lote">
  <!--Body de tabla-->
  <tbody>
    <% # Vairables. row: tamaño de rowspan en edición %>
    <% # bool: pintar solo un th de color%>
    <%bool = true%>
    <%row = @colores.nil? ? 1 : @colores.length%>
    <%i = 0%>
    <%=f.fields_for :colores_lotes do |color_lote|%>
    <tr>
      <% if bool%>
      <th scope="rowgroup" rowspan="<%=row%>" style="padding:0; margin:0;" class="text-center"
        id="row_sp_color">
        Colores
      </th>
      <%bool = false%>
      <%end%>
      <%=render partial: 'color_lote_fields', locals: {col: @colores.nil? ? "" : @colores.fetch(i), total: @totales.nil? ? nil : @totales.fetch(i), f: color_lote, b: false }%>
    </tr>
    <% i += 1 %>
    <%end%>
  </tbody>
  <%
  # El objetivo de poner el thead debajo del tbody es 
  # que no exista interferencia con el fields_for que hay en el 
  # tbody
  %>
  <!--Head de tabla-->
  <thead>
    <tr class="small" title="Talla tipo A">
      <th scope="col" rowspan="3" class="text-center">Cantidad Corte</th>
      <th scope="col" rowspan="3">Tallas</th>
      <% # Variable. cont: controlador para filas de tallas%>
      <%cont = 0%>

      <%@tallas.each do |talla|%>
      <% if cont == 0%>
      <th scope="col" class="col-lg-1"><%=talla.talla%></th>
      <%end%>
      <%cont == 2 ? cont = 0 : cont = cont + 1%>
      <%end%>

      <th scope="col" rowspan="2" class="text-center">
        <%
        # Nuevos campos para colores y cantidades
        @colores_lotes = @lote.colores_lotes.build
        @cantidades = @colores_lotes.cantidades.build
        %>
        <%= link_to_add_fields "","add_fields btn btn-primary  
        fa fa-plus", f, :colores_lotes %>
      </th>
    </tr>
    <tr class="small" title="Talla tipo B">
      <%cont = 0%>

      <%@tallas.each do |talla|%>
      <% if cont == 1%>
      <th scope="col" class="col-lg-1"><%=talla.talla%></th>
      <%end%>
      <%cont == 2 ? cont = 0 : cont = cont + 1%>
      <%end%>

    </tr>
    <tr class="small" title="Talla tipo C">
      <%cont = 0%>

      <%@tallas.each do |talla|%>
      <% if cont == 2%>
      <th scope="col" class="col-lg-1"><%=talla.talla%></th>
      <%end%>
      <%cont == 2 ? cont = 0 : cont = cont + 1%>
      <%end%>

      <th scope="col">
        Total colores
      </th>
    </tr>
  </thead>
  <!--Foot de tabla-->
  <tfoot>
    <tr>
      <th scope="row" style="padding:0; margin:0;" title="Total"  class="text-center">Total</th>

      <%for n in 0..9%>
      <td style="padding:0; margin:0;">
        <%if n > 0%>
        <input id="total<%=n%>" class="form-control input-sm" 
        type="number" disabled="disabled" title="Total de&#10; talla <%=n + (n + 4)%>"
        value="<%= !@totales_tallas.nil? ? @totales_tallas.fetch(n - 1) : 0%>"/>
        <%end%>
      </td>
      <%end%>
      
      <td class="total" style="padding:0; margin:0;">
        <%=f.input :cantidad, readonly: true, label: false,
        input_html:{class: "input-sm", title: "Total absoluto"}%>
      </td>
    </tr>
  </tfoot>
</table>