<div class="page-header">
  <h4 class="pull-left">Clientes por año</h4>
  <div class="text-right">
    <%= link_to estadisticas_path, :class => "btn btn-default btn-sm" do %>
        <i class="fa fa-arrow-left" aria-hidden="true"></i>
    <% end %>
  </div>
</div>
<div class="row">
  <% @years.each do |year| %>
      <div class="col-md-6">
        <div class="panel panel-primary">
          <div class="panel-heading">
            <%= year %>
            <% if !@year_clientes[year].empty? %>
                <div class="pull-right">
                  <div class="dropdown pull-left">
                    <button type="button" class="btn btn-warning btn-xs dropdown-toggle" data-toggle="dropdown">
                      Cliente
                      <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu pull-right" role="menu" style="z-index: 10000;">
                      <% @year_clientes[year].each do |lote| %>
                          <li>
                            <%= link_to lote.cliente.name, clientes_show_path(year, :cliente => lote.cliente.name),
                                        remote: true, class: "show_filter" %>
                          </li>
                      <% end %>
                    </ul>
                  </div>
                  <span class="col-xs-1"></span>
                  <div class="dropdown pull-right">
                    <button type="button" class="btn btn-warning btn-xs dropdown-toggle" data-toggle="dropdown">
                      Mes
                      <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu pull-right" role="menu" style="z-index: 10000;">
                      <% @meses.each do |key, val| %>
                          <li>
                            <%= link_to val[:string], clientes_month_show_path("#{year}-#{val[:number]}", :month => val[:string]),
                                        remote: true, class: "show_filter" %>
                          </li>
                      <% end %>
                    </ul>
                  </div>
                </div>
            <% end %>
          </div>
          <div class="panel-body">
            <div id="<%= year %>"></div>
          </div>
        </div>
      </div>
  <% end %>
</div>
<script type="text/javascript">

  //Pintar gráficos necesarios
  <% @year_clientes.each do |year, amount| %>
    <% if amount.empty? %>
      $("#<%=year%>").html("<h4>No hay datos</h4>");
    <% else %>
      $("#<%=year%>").css("height","200px");
      new Morris.Bar({
        element: '<%=year%>',
        data: [
          <% amount.each do |a| %>
          {cliente: '<%= a.cliente.name %>', value: <%= a.cantidad %>},
          <% end %>
        ],
        xkey: 'cliente',
        ykeys: ['value'],
        labels: ['Cantidad'],
        resize: true
      });
    <% end %>
  <% end %>
</script>